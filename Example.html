<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Socketify Example</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            font-size: 0;
            box-sizing: border-box;
            border: 0;
            outline: 0;
            font-family: sans-serif;
        }

        html,
        body {
            height: 100%;
        }

        #unavailable {
            display: none;
            margin: 64px;
            font-size: 24px;
            color: red;
            text-align: center;
        }

        #page {
            display: none;
            margin: auto;
            padding: 32px;
            max-width: 960px;
            height: 100%;
        }

        #type {
            height: 48px;
        }

        #type a {
            display: inline-block;
            margin-right: 32px;
            font-size: 32px;
            color: gray;
            cursor: pointer;
            vertical-align: bottom;
        }

        #type .active {
            box-shadow: 0 2px 0 black;
            color: black;
        }

        #type a:hover {
            color: black;
        }

        #events {
            margin-top: 16px;
        }

        #events * {
            height: 48px;
        }

        #events input {
            padding: 0 16px;
            width: calc(100% - 416px);
            font-size: 16px;
            border: 2px solid black;
        }

        #events button {
            font-size: 16px;
            padding: 12px 16px;
            margin-left: 8px;
            width: 96px;
            color: white;
            background: black;
            cursor: pointer;
        }

        #events button:hover {
            background: gray;
        }

        #events button:active {
            color: black;
        }

        #logs {
            margin-top: 32px;
            padding: 32px;
            height: calc(100% - 144px);
            overflow-x: hidden;
            overflow-y: scroll;
            background: #eee;
        }

        #logs * {
            font-size: 16px;
        }

        #logs div {
            margin-bottom: 16px;
        }

        #logs div span {
            display: inline-block;
            font-size: 14px;
            padding: 4px 8px;
            margin-right: 8px;
            color: #eee;
            background: black;
        }

        #logs div b {
            color: blue;
        }

        #logs div div {
            margin-top: 8px;
            margin-left: 24px;
            padding-left: 16px;
            font-size: 14px;
            border-left: 1px solid gray;
        }

        #logs .address {
            color: green;
        }

        #logs .error {
            color: red;
        }

        #logs .noError {
            color: gray;
        }
    </style>
    <script>
        var udpPeerElem = undefined;
        var tcpClientElem = undefined;
        var tcpServerElem = undefined;

        var inputElem = undefined;

        var logsElem = undefined;

        function init() {
            console.log(`init()`);

            setTimeout(function () {
                if (window.socketify) {
                    document.getElementById("page").style.display = "block";
                } else {
                    document.getElementById("unavailable").style.display = "block";
                }
            }, 1000);

            udpPeerElem = document.getElementById("udpPeer");
            tcpClientElem = document.getElementById("tcpClient");
            tcpServerElem = document.getElementById("tcpServer");

            inputElem = document.getElementById("input");

            logsElem = document.getElementById("logs");
        }

        var udpPeer = undefined;
        var tcpClient = undefined;
        var tcpServer = undefined;

        var activeType = "udpPeer";

        function switchTo(type) {
            console.log(`switchTo(${type}) - activeType: ${activeType}`);

            if (type === activeType) {
                return;
            }

            switch (type) {
                case "udpPeer": {
                    activeType = type;

                    if (tcpClient) {
                        tcpClient.close();
                        tcpClient = undefined;
                    }
                    if (tcpServer) {
                        tcpServer.close();
                        tcpServer = undefined;
                    }

                    udpPeerElem.className = "active";
                    tcpClientElem.className = "";
                    tcpServerElem.className = "";
                } break;
                case "tcpClient": {
                    activeType = type;

                    if (udpPeer) {
                        udpPeer.close();
                        udpPeer = undefined;
                    }
                    if (tcpServer) {
                        tcpServer.close();
                        tcpServer = undefined;
                    }

                    udpPeerElem.className = "";
                    tcpClientElem.className = "active";
                    tcpServerElem.className = "";
                } break;
                case "tcpServer": {
                    activeType = type;

                    if (udpPeer) {
                        udpPeer.close();
                        udpPeer = undefined;
                    }
                    if (tcpClient) {
                        tcpClient.close();
                        tcpClient = undefined;
                    }

                    udpPeerElem.className = "";
                    tcpClientElem.className = "";
                    tcpServerElem.className = "active";
                } break;
            }

            console.log(`~switchTo(${type}) - activeType: ${activeType}`);
        }

        function getInput() {
            var input = inputElem.value;
            inputElem.value = "";
            return input;
        }

        function escapeHTML(raw) {
            return raw
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&apos;");
        }

        function addLog(event, message) {
            console.log(`addLog():`, event, message);

            switch (activeType) {
                case "udpPeer": {

                } break;
                case "tcpClient": {

                } break;
                case "tcpServer": {

                } break;
            }
        }

        function openClick(input) {
            console.log(`openCLick(${input})`);

            switch (activeType) {
                case "udpPeer": {

                } break;
                case "tcpClient": {

                } break;
                case "tcpServer": {

                } break;
            }
        }

        function sendClick(input) {
            console.log(`sendClick(${input})`);

            switch (activeType) {
                case "udpPeer": {

                } break;
                case "tcpClient": {

                } break;
                case "tcpServer": {

                } break;
            }
        }

        function dropClick(input) {
            console.log(`dropClick(${input})`);

            switch (activeType) {
                case "udpPeer": {

                } break;
                case "tcpClient": {

                } break;
                case "tcpServer": {

                } break;
            }
        }

        function closeClick() {
            console.log(`closeClick()`);

            switch (activeType) {
                case "udpPeer": {

                } break;
                case "tcpClient": {

                } break;
                case "tcpServer": {

                } break;
            }
        }
    </script>
</head>

<body onload="init()">
    <div id="unavailable">Uh-oh! Socketify is unavailable :(</div>
    <div id="page">
        <div id="type">
            <a id="udpPeer" onclick="switchTo('udpPeer')" class="active">UDP Peer</a>
            <a id="tcpClient" onclick="switchTo('tcpClient')">TCP Client</a>
            <a id="tcpServer" onclick="switchTo('tcpServer')">TCP Server</a>
        </div>
        <div id="events">
            <input id="input" maxlength="1500" placeholder="Input">
            <button id="open" onclick="openClick(getInput())">Open</button>
            <button id="send" onclick="sendClick(getInput())">Send</button>
            <button id="drop" onclick="dropClick(getInput())">Drop</button>
            <button id="close" onclick="closeClick(getInput())">Close</button>
        </div>
        <div id="logs">
            <div><span>udpPeer</span><b>open &rarr; </b>bound to <i class="address">&lt;127.0.0.1:9696&gt;</i></div>
            <div><span>tcpServer</span><b>connect &rarr; </b>accepted <i class="address">&lt;127.0.0.1:1234&gt;</i></div>
            <div>
                <span>tcpClient</span><b>receive &rarr; </b>message from <i class="address">&lt;127.0.0.1:1234&gt;</i>
                <div>{ msg: "Hey, I'm Client X!" }</div>
            </div>
            <div><span>udpPeer</span><b>disconnect &rarr; </b>dropped <i class="address">&lt;127.0.0.1:1234&gt;</i>
                with error: <i class="error">connection closed</i></div>
            <div><span>udpPeer</span><b>close &rarr; </b>with error: <i class="noError">none</i></div>
            <div><span>udpPeer</span><b>open &rarr; </b>bound to <i class="address">&lt;127.0.0.1:9696&gt;</i></div>
            <div><span>tcpServer</span><b>connect &rarr; </b>accepted <i class="address">&lt;127.0.0.1:1234&gt;</i></div>
            <div>
                <span>tcpClient</span><b>receive &rarr; </b>message from <i class="address">&lt;127.0.0.1:1234&gt;</i>
                <div>{ msg: "Hey, I'm Client X!" }</div>
            </div>
            <div><span>udpPeer</span><b>disconnect &rarr; </b>dropped <i class="address">&lt;127.0.0.1:1234&gt;</i>
                with error: <i class="error">connection closed</i></div>
            <div><span>udpPeer</span><b>close &rarr; </b>with error: <i class="noError">none</i></div>
            <div><span>udpPeer</span><b>open &rarr; </b>bound to <i class="address">&lt;127.0.0.1:9696&gt;</i></div>
            <div><span>tcpServer</span><b>connect &rarr; </b>accepted <i class="address">&lt;127.0.0.1:1234&gt;</i></div>
            <div>
                <span>tcpClient</span><b>receive &rarr; </b>message from <i class="address">&lt;127.0.0.1:1234&gt;</i>
                <div>{ msg: "Hey, I'm Client X!" }</div>
            </div>
            <div><span>udpPeer</span><b>disconnect &rarr; </b>dropped <i class="address">&lt;127.0.0.1:1234&gt;</i>
                with error: <i class="error">connection closed</i></div>
            <div><span>udpPeer</span><b>close &rarr; </b>with error: <i class="noError">none</i></div>
            <div><span>udpPeer</span><b>open &rarr; </b>bound to <i class="address">&lt;127.0.0.1:9696&gt;</i></div>
            <div><span>tcpServer</span><b>connect &rarr; </b>accepted <i class="address">&lt;127.0.0.1:1234&gt;</i></div>
            <div>
                <span>tcpClient</span><b>receive &rarr; </b>message from <i class="address">&lt;127.0.0.1:1234&gt;</i>
                <div>{ msg: "Hey, I'm Client X!" }</div>
            </div>
            <div><span>udpPeer</span><b>disconnect &rarr; </b>dropped <i class="address">&lt;127.0.0.1:1234&gt;</i>
                with error: <i class="error">connection closed</i></div>
            <div><span>udpPeer</span><b>close &rarr; </b>with error: <i class="noError">none</i></div>
            <div><span>udpPeer</span><b>open &rarr; </b>bound to <i class="address">&lt;127.0.0.1:9696&gt;</i></div>
            <div><span>tcpServer</span><b>connect &rarr; </b>accepted <i class="address">&lt;127.0.0.1:1234&gt;</i></div>
            <div>
                <span>tcpClient</span><b>receive &rarr; </b>message from <i class="address">&lt;127.0.0.1:1234&gt;</i>
                <div>{ msg: "Hey, I'm Client X!" }</div>
            </div>
            <div><span>udpPeer</span><b>disconnect &rarr; </b>dropped <i class="address">&lt;127.0.0.1:1234&gt;</i>
                with error: <i class="error">connection closed</i></div>
            <div><span>udpPeer</span><b>close &rarr; </b>with error: <i class="noError">none</i></div>
            <div><span>udpPeer</span><b>open &rarr; </b>bound to <i class="address">&lt;127.0.0.1:9696&gt;</i></div>
            <div><span>tcpServer</span><b>connect &rarr; </b>accepted <i class="address">&lt;127.0.0.1:1234&gt;</i></div>
            <div>
                <span>tcpClient</span><b>receive &rarr; </b>message from <i class="address">&lt;127.0.0.1:1234&gt;</i>
                <div>{ msg: "Hey, I'm Client X!" }</div>
            </div>
            <div><span>udpPeer</span><b>disconnect &rarr; </b>dropped <i class="address">&lt;127.0.0.1:1234&gt;</i>
                with error: <i class="error">connection closed</i></div>
            <div><span>udpPeer</span><b>close &rarr; </b>with error: <i class="noError">none</i></div>
        </div>
    </div>
</body>

</html>